<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareSync - Hospital Dashboard</title>
    <link rel="stylesheet" href="https://caresync-hospital-dashboard-mvm3.vercel.app/css/style.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="dashboard-page" id="dashboardPage">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="logo">
            <i class="fas fa-hospital"></i>
            <span>CareSync</span>
        </div>

        <nav class="nav-menu">
            <a href="#overview" class="nav-link active" onclick="showSection('overview')">
                <i class="fas fa-tachometer-alt"></i>
                <span>Overview</span>
            </a>
            <a href="#beds" class="nav-link" onclick="showSection('beds')">
                <i class="fas fa-bed"></i>
                <span>Bed Management</span>
            </a>
            <a href="#ambulance" class="nav-link" onclick="showSection('ambulance')">
                <i class="fas fa-ambulance"></i>
                <span>Ambulance Fleet</span>
            </a>
            <a href="#emergencies" class="nav-link" onclick="showSection('emergencies')">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Emergency Alerts</span>
            </a>
            <a href="#doctors" class="nav-link" onclick="showSection('doctors')">
                <i class="fas fa-user-md"></i>
                <span>Doctors</span>
            </a>
            <a href="#appointments" class="nav-link" onclick="showSection('appointments')">
                <i class="fas fa-calendar-check"></i>
                <span>Appointments</span>
            </a>
            <a href="#settings" class="nav-link" onclick="showSection('settings')">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="btn-logout" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="top-bar-left">
                <button class="menu-toggle" id="menuToggle" title="Toggle menu">
                    <i class="fas fa-bars"></i>
                </button>
                <h2>Hospital Dashboard</h2>
            </div>
            <div class="top-bar-right">
                <div class="search-box" role="search">
                    <i class="fas fa-search"></i>
                    <input id="globalSearch" type="text" placeholder="Search patients, doctors, appointments...">
                </div>
                <div class="notifications icon-btn" id="notificationsBtn" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="badge" id="notifCount">3</span>
                </div>
                <div class="user-profile">
                    <div class="user-avatar">H</div>
                    <span id="hospitalName">Hospital Admin</span>
                </div>
            </div>
        </div>

        <!-- Overview Section -->
        <div id="overview" class="content-section active">
            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="totalPatients">0</h3>
                        <p>Total Patients</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="totalDoctors">0</h3>
                        <p>Active Doctors</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orange">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="todayAppointments">0</h3>
                        <p>Today's Appointments</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon red">
                        <i class="fas fa-bed"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="availableBeds">0</h3>
                        <p>Available Beds</p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h3>Quick Actions</h3>
                <div class="action-buttons-grid">
                    <button class="action-btn" onclick="showSection('beds')">
                        <i class="fas fa-bed"></i>
                        <span>Manage Beds</span>
                    </button>
                    <button class="action-btn" onclick="showSection('ambulance')">
                        <i class="fas fa-ambulance"></i>
                        <span>Manage Ambulance</span>
                    </button>
                    <button class="action-btn" onclick="openDoctorModal()">
                        <i class="fas fa-user-plus"></i>
                        <span>Add Doctor</span>
                    </button>
                    <button class="action-btn" onclick="openAppointmentModal()">
                        <i class="fas fa-calendar-plus"></i>
                        <span>New Appointment</span>
                    </button>
                </div>
            </div>

            <!-- Recent Emergency Alerts -->
            <div class="recent-alerts">
                <h3>Recent Emergency Alerts</h3>
                <div id="recentAlerts">
                    <p class="text-muted">No recent emergencies</p>
                </div>
            </div>
        </div>

        <!-- Emergency Alerts Section -->
        <div id="emergencies" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-exclamation-triangle"></i> Emergency Alerts</h2>
            </div>
            <div id="emergencyList" class="emergency-list">
                <p class="text-muted">No active emergencies</p>
            </div>
        </div>

        <!-- Bed Management Section -->
        <div id="beds" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-bed"></i> Bed Management</h2>
            </div>
            <div class="beds-grid">
                <div class="bed-card general">
                    <div class="bed-header">
                        <h3><i class="fas fa-bed"></i> General Ward</h3>
                        <span class="status-badge success">Available</span>
                    </div>
                    <div class="bed-stats">
                        <div class="bed-stat">
                            <span>Total</span>
                            <strong id="general-total">0</strong>
                        </div>
                        <div class="bed-stat">
                            <span>Available</span>
                            <strong id="general-available">0</strong>
                        </div>
                        <div class="bed-stat">
                            <span>Occupied</span>
                            <strong id="general-occupied">0</strong>
                        </div>
                    </div>
                    <button class="btn-manage" onclick="openBedModal('general')">
                        <i class="fas fa-edit"></i> Manage
                    </button>
                </div>

                <div class="bed-card icu">
                    <div class="bed-header">
                        <h3><i class="fas fa-procedures"></i> ICU</h3>
                        <span class="status-badge danger">Critical</span>
                    </div>
                    <div class="bed-stats">
                        <div class="bed-stat">
                            <span>Total</span>
                            <strong id="icu-total">0</strong>
                        </div>
                        <div class="bed-stat">
                            <span>Available</span>
                            <strong id="icu-available">0</strong>
                        </div>
                        <div class="bed-stat">
                            <span>Occupied</span>
                            <strong id="icu-occupied">0</strong>
                        </div>
                    </div>
                    <button class="btn-manage" onclick="openBedModal('icu')">
                        <i class="fas fa-edit"></i> Manage
                    </button>
                </div>

                <div class="bed-card emergency">
                    <div class="bed-header">
                        <h3><i class="fas fa-hospital"></i> Emergency</h3>
                        <span class="status-badge warning">Moderate</span>
                    </div>
                    <div class="bed-stats">
                        <div class="bed-stat">
                            <span>Total</span>
                            <strong id="emergency-total">0</strong>
                        </div>
                        <div class="bed-stat">
                            <span>Available</span>
                            <strong id="emergency-available">0</strong>
                        </div>
                        <div class="bed-stat">
                            <span>Occupied</span>
                            <strong id="emergency-occupied">0</strong>
                        </div>
                    </div>
                    <button class="btn-manage" onclick="openBedModal('emergency')">
                        <i class="fas fa-edit"></i> Manage
                    </button>
                </div>

                <div class="bed-card private">
                    <div class="bed-header">
                        <h3><i class="fas fa-door-closed"></i> Private</h3>
                        <span class="status-badge success">Available</span>
                    </div>
                    <div class="bed-stats">
                        <div class="bed-stat">
                            <span>Total</span>
                            <strong id="private-total">0</strong>
                        </div>
                        <div class="bed-stat">
                            <span>Available</span>
                            <strong id="private-available">0</strong>
                        </div>
                        <div class="bed-stat">
                            <span>Occupied</span>
                            <strong id="private-occupied">0</strong>
                        </div>
                    </div>
                    <button class="btn-manage" onclick="openBedModal('private')">
                        <i class="fas fa-edit"></i> Manage
                    </button>
                </div>
            </div>
        </div>

        <!-- Doctors Section -->
        <div id="doctors" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-user-md"></i> Doctors</h2>
                <button class="btn-primary" onclick="openDoctorModal()">
                    <i class="fas fa-plus"></i> Add Doctor
                </button>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Doctor Name</th>
                            <th>Specialization</th>
                            <th>Contact</th>
                            <th>HFR Number</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="doctorsTableBody">
                        <tr>
                            <td colspan="5" class="text-center">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Appointments Section -->
        <div id="appointments" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-calendar-check"></i> Appointments</h2>
                <button class="btn-primary" onclick="openAppointmentModal()">
                    <i class="fas fa-plus"></i> New Appointment
                </button>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Patient</th>
                            <th>Doctor</th>
                            <th>Date & Time</th>
                            <th>Reason</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="appointmentsTableBody">
                        <tr>
                            <td colspan="6" class="text-center">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Ambulance Section -->
        <div id="ambulance" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-ambulance"></i> Ambulance Fleet</h2>
                <button class="btn-primary" onclick="openAmbulanceModal()">
                    <i class="fas fa-plus"></i> Add Ambulance
                </button>
            </div>

            <!-- Ambulance Stats -->
            <div class="ambulance-stats">
                <div class="stat-card-small">
                    <h4 id="ambulanceTotal">0</h4>
                    <p>Total</p>
                </div>
                <div class="stat-card-small">
                    <h4 id="ambulanceAvailable">0</h4>
                    <p>Available</p>
                </div>
                <div class="stat-card-small">
                    <h4 id="ambulanceOnDuty">0</h4>
                    <p>On Duty</p>
                </div>
                <div class="stat-card-small">
                    <h4 id="ambulanceMaintenance">0</h4>
                    <p>Maintenance</p>
                </div>
            </div>

            <!-- Ambulance List -->
            <div id="ambulanceList" class="ambulance-grid">
                <p class="text-muted">No ambulances registered</p>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settings" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-cog"></i> Hospital Settings</h2>
            </div>
            <div class="settings-container">
                <div class="setting-card">
                    <h3><i class="fas fa-hospital"></i> Hospital Information</h3>
                    <form id="hospitalInfoForm">
                        <div class="form-group">
                            <label>Hospital Name</label>
                            <input type="text" id="settingHospitalName" placeholder="Hospital Name">
                        </div>
                        <div class="form-group">
                            <label>Address</label>
                            <textarea id="settingAddress" rows="3" placeholder="Hospital Address"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Contact Number</label>
                            <input type="tel" id="settingPhone" placeholder="Contact Number">
                        </div>
                        <div class="form-group">
                            <label>Emergency Contact</label>
                            <input type="tel" id="settingEmergencyPhone" placeholder="Emergency Number">
                        </div>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bed Management Modal -->
    <div id="bedModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeBedModal()">&times;</span>
            <h2 id="bedModalTitle">Manage Beds</h2>
            <form id="bedForm">
                <div class="form-group">
                    <label for="bedTotalInput"><i class="fas fa-bed"></i> Total Beds</label>
                    <input type="number" id="bedTotalInput" min="0" required placeholder="Enter total beds">
                </div>
                <div class="form-group">
                    <label for="bedAvailableInput"><i class="fas fa-check-circle"></i> Available Beds</label>
                    <input type="number" id="bedAvailableInput" min="0" required placeholder="Enter available beds">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeBedModal()">Cancel</button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ambulance Modal -->
    <div id="ambulanceModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeAmbulanceModal()">&times;</span>
            <h2>Add Ambulance</h2>
            <form id="ambulanceForm">
                <div class="form-group">
                    <label for="vehicleNumber"><i class="fas fa-car"></i> Vehicle Number *</label>
                    <input type="text" id="vehicleNumber" required placeholder="Enter vehicle number">
                </div>
                <div class="form-group">
                    <label for="driverName"><i class="fas fa-user"></i> Driver Name *</label>
                    <input type="text" id="driverName" required placeholder="Enter driver name">
                </div>
                <div class="form-group">
                    <label for="driverPhone"><i class="fas fa-phone"></i> Driver Phone *</label>
                    <input type="tel" id="driverPhone" required placeholder="10-digit phone number" pattern="[0-9]{10}"
                        maxlength="10">
                </div>
                <div class="form-group">
                    <label for="ambulanceType"><i class="fas fa-ambulance"></i> Type</label>
                    <select id="ambulanceType">
                        <option value="Basic">Basic</option>
                        <option value="Advanced">Advanced</option>
                        <option value="ICU">ICU Ambulance</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeAmbulanceModal()">Cancel</button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-plus"></i> Add Ambulance
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Doctor Modal -->
    <div id="doctorModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeDoctorModal()">&times;</span>
            <h2 id="doctorModalTitle">Add New Doctor</h2>

            <form id="doctorForm">
                <div class="form-group">
                    <label for="doctorName"><i class="fas fa-user-md"></i> Doctor Name *</label>
                    <input type="text" id="doctorName" required placeholder="Enter doctor's full name">
                </div>

                <div class="form-group">
                    <label for="doctorSpecialization"><i class="fas fa-stethoscope"></i> Specialization *</label>
                    <input type="text" id="doctorSpecialization" required placeholder="e.g., Cardiology, Orthopedics">
                </div>

                <div class="form-group">
                    <label for="doctorPhone"><i class="fas fa-phone"></i> Phone Number *</label>
                    <input type="tel" id="doctorPhone" required placeholder="10-digit phone number" pattern="[0-9]{10}"
                        maxlength="10">
                </div>

                <div class="form-group">
                    <label for="doctorEmail"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="doctorEmail" placeholder="doctor@example.com">
                </div>

                <div class="form-group">
                    <label for="doctorHFR"><i class="fas fa-id-card"></i> HFR Number</label>
                    <input type="text" id="doctorHFR" placeholder="Doctor's HFR registration number">
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeDoctorModal()">Cancel</button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i> Save Doctor
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Appointment Modal -->
    <div id="appointmentModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeAppointmentModal()">&times;</span>
            <h2 id="appointmentModalTitle">Add New Appointment</h2>

            <form id="appointmentForm">
                <div class="form-group">
                    <label for="aptPatientName"><i class="fas fa-user"></i> Patient Name *</label>
                    <input type="text" id="aptPatientName" required placeholder="Enter patient's name">
                </div>

                <div class="form-group">
                    <label for="aptDoctorId"><i class="fas fa-user-md"></i> Select Doctor *</label>
                    <select id="aptDoctorId" required>
                        <option value="">Loading doctors...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="aptDate"><i class="fas fa-calendar"></i> Appointment Date & Time *</label>
                    <input type="datetime-local" id="aptDate" required>
                </div>

                <div class="form-group">
                    <label for="aptReason"><i class="fas fa-notes-medical"></i> Reason</label>
                    <textarea id="aptReason" rows="3" placeholder="Reason for visit (optional)"></textarea>
                </div>

                <div class="form-group">
                    <label for="aptStatus"><i class="fas fa-info-circle"></i> Status</label>
                    <select id="aptStatus">
                        <option value="pending">Pending</option>
                        <option value="confirmed">Confirmed</option>
                        <option value="cancelled">Cancelled</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeAppointmentModal()">Cancel</button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i> Save Appointment
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Dashboard Script (external) -->
    <script src="/js/dashboard.js"></script>

    <!-- Inline connectors & small UI script -->
    <script>
        // Minimal connector script: toggles sidebar, switches sections, modals, ripple and simple form handlers.
        (function(){
            const dashboardPage = document.getElementById('dashboardPage');
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.getElementById('menuToggle');
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.content-section');

            function showSection(id){
                sections.forEach(s => s.classList.remove('active'));
                const el = document.getElementById(id);
                if(el) el.classList.add('active');
                navLinks.forEach(a => a.classList.toggle('active', a.getAttribute('href') === '#' + id));
            }
            window.showSection = showSection;

            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
                dashboardPage.classList.toggle('collapsed');
            });

            navLinks.forEach(a => {
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    const target = a.getAttribute('href').replace('#','');
                    showSection(target);
                });
            });

            // Modal helpers
            function openModal(id){ document.getElementById(id).classList.add('active'); }
            function closeModal(id){ document.getElementById(id).classList.remove('active'); }
            window.openDoctorModal = () => openModal('doctorModal');
            window.closeDoctorModal = () => closeModal('doctorModal');
            window.openBedModal = (type) => {
                document.getElementById('bedModalTitle').textContent = 'Manage ' + (type || 'Beds');
                document.getElementById('bedModal').classList.add('active');
                document.getElementById('bedModal').dataset.type = type || '';
            };
            window.closeBedModal = () => closeModal('bedModal');
            window.openAmbulanceModal = () => openModal('ambulanceModal');
            window.closeAmbulanceModal = () => closeModal('ambulanceModal');
            window.openAppointmentModal = () => openModal('appointmentModal');
            window.closeAppointmentModal = () => closeModal('appointmentModal');

            // Ripple effect for buttons
            document.addEventListener('click', function(e){
                const btn = e.target.closest('.btn-primary, .action-btn, .table-action-btn, .btn-manage');
                if(!btn) return;
                const rect = btn.getBoundingClientRect();
                const ripple = document.createElement('span');
                ripple.className = 'ripple';
                ripple.style.left = (e.clientX - rect.left) + 'px';
                ripple.style.top = (e.clientY - rect.top) + 'px';
                btn.appendChild(ripple);
                setTimeout(()=> ripple.remove(), 650);
            });

            // Simple form handlers to update UI
            const doctorsTable = document.getElementById('doctorsTableBody');
            const doctorForm = document.getElementById('doctorForm');
            if(doctorForm){
                doctorForm.addEventListener('submit', function(e){
                    e.preventDefault();
                    const name = document.getElementById('doctorName').value.trim();
                    const spec = document.getElementById('doctorSpecialization').value.trim();
                    const phone = document.getElementById('doctorPhone').value.trim();
                    const hfr = document.getElementById('doctorHFR').value.trim();
                    if(!name || !spec) return;
                    const tr = document.createElement('tr');
                    tr.innerHTML = '<td>'+escapeHtml(name)+'</td><td>'+escapeHtml(spec)+'</td><td>'+escapeHtml(phone)+'</td><td>'+escapeHtml(hfr)+'</td><td><button class="table-action-btn edit">Edit</button><button class="table-action-btn delete">Delete</button></td>';
                    // replace "Loading..." row if present
                    if(doctorsTable.children.length === 1 && doctorsTable.children[0].textContent.includes('Loading')) doctorsTable.innerHTML = '';
                    doctorsTable.appendChild(tr);
                    // update doctor count
                    const totalDoctorsEl = document.getElementById('totalDoctors');
                    totalDoctorsEl.textContent = parseInt(totalDoctorsEl.textContent || '0') + 1;
                    closeModal('doctorModal');
                    doctorForm.reset();
                });
            }

            const ambulanceList = document.getElementById('ambulanceList');
            const ambulanceForm = document.getElementById('ambulanceForm');
            if(ambulanceForm){
                ambulanceForm.addEventListener('submit', function(e){
                    e.preventDefault();
                    const vehicle = document.getElementById('vehicleNumber').value.trim();
                    const driver = document.getElementById('driverName').value.trim();
                    const phone = document.getElementById('driverPhone').value.trim();
                    if(!vehicle || !driver) return;
                    const card = document.createElement('div');
                    card.className = 'ambulance-card';
                    card.innerHTML = '<div class="ambulance-header"><div class="ambulance-number"><i class="fas fa-ambulance"></i> '+escapeHtml(vehicle)+'</div><div class="ambulance-status available">Available</div></div><div class="ambulance-details"><div class="ambulance-detail-item"><label>Driver</label><span>'+escapeHtml(driver)+'</span></div><div class="ambulance-detail-item"><label>Contact</label><span>'+escapeHtml(phone)+'</span></div></div><div class="ambulance-actions"><button class="btn-track">Track</button><button class="btn-update">Update</button></div>';
                    if(ambulanceList.children.length ===1 && ambulanceList.children[0].textContent.includes('No ambulances')) ambulanceList.innerHTML = '';
                    ambulanceList.prepend(card);
                    // update stats
                    document.getElementById('ambulanceTotal').textContent = (parseInt(document.getElementById('ambulanceTotal').textContent||'0')+1);
                    document.getElementById('ambulanceAvailable').textContent = (parseInt(document.getElementById('ambulanceAvailable').textContent||'0')+1);
                    closeModal('ambulanceModal');
                    ambulanceForm.reset();
                });
            }

            // Bed form update simple
            const bedForm = document.getElementById('bedForm');
            if(bedForm){
                bedForm.addEventListener('submit', function(e){
                    e.preventDefault();
                    const total = parseInt(document.getElementById('bedTotalInput').value || '0');
                    const available = parseInt(document.getElementById('bedAvailableInput').value || '0');
                    const type = document.getElementById('bedModal').dataset.type || 'general';
                    const totalEl = document.getElementById(type+'-total');
                    const availableEl = document.getElementById(type+'-available');
                    const occupiedEl = document.getElementById(type+'-occupied');
                    if(totalEl) totalEl.textContent = total;
                    if(availableEl) availableEl.textContent = available;
                    if(occupiedEl) occupiedEl.textContent = Math.max(0, total - available);
                    // update overview available beds sum
                    const sum = ['general','icu','emergency','private'].reduce((acc,k)=> {
                        const v = parseInt(document.getElementById(k+'-available')?.textContent||'0'); return acc+v;
                    },0);
                    document.getElementById('availableBeds').textContent = sum;
                    closeModal('bedModal');
                });
            }

            // Appointment form - simple append
            const aptForm = document.getElementById('appointmentForm');
            const aptBody = document.getElementById('appointmentsTableBody');
            if(aptForm){
                aptForm.addEventListener('submit', function(e){
                    e.preventDefault();
                    const patient = document.getElementById('aptPatientName').value.trim();
                    const doctorSel = document.getElementById('aptDoctorId');
                    const doctorName = doctorSel.options[doctorSel.selectedIndex]?.text || '';
                    const date = document.getElementById('aptDate').value;
                    const reason = document.getElementById('aptReason').value || '';
                    const status = document.getElementById('aptStatus').value || 'pending';
                    if(!patient || !doctorName || !date) return;
                    const tr = document.createElement('tr');
                    tr.innerHTML = '<td>'+escapeHtml(patient)+'</td><td>'+escapeHtml(doctorName)+'</td><td>'+escapeHtml(date)+'</td><td>'+escapeHtml(reason)+'</td><td><span class="status-badge status-'+escapeHtml(status)+'">'+escapeHtml(status)+'</span></td><td><button class="table-action-btn view">View</button></td>';
                    if(aptBody.children.length ===1 && aptBody.children[0].textContent.includes('Loading')) aptBody.innerHTML = '';
                    aptBody.appendChild(tr);
                    // increment today's appointments count if date is today (basic)
                    const todayCountEl = document.getElementById('todayAppointments');
                    const aptDate = new Date(date);
                    const now = new Date();
                    if(aptDate.toDateString() === now.toDateString()){
                        todayCountEl.textContent = parseInt(todayCountEl.textContent||'0') + 1;
                    }
                    closeModal('appointmentModal');
                    aptForm.reset();
                });
            }

            // small helper to escape text nodes
            function escapeHtml(s){ return String(s).replace(/[&<>"]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[c])); }

            // simple population of doctor select based on existing table rows (keeps things connected)
            function populateDoctorSelect(){
                const sel = document.getElementById('aptDoctorId');
                if(!sel) return;
                sel.innerHTML = '';
                const rows = doctorsTable ? Array.from(doctorsTable.querySelectorAll('tr')) : [];
                const options = rows.map(r=> r.cells?.[0]?.textContent).filter(Boolean);
                if(options.length === 0){
                    const opt = document.createElement('option'); opt.value=''; opt.textContent = 'No doctors available'; sel.appendChild(opt);
                } else {
                    sel.innerHTML = '<option value="">Select doctor</option>';
                    options.forEach((name, idx)=>{
                        const o = document.createElement('option');
                        o.value = 'd'+idx;
                        o.textContent = name;
                        sel.appendChild(o);
                    });
                }
            }
            // keep doctor select in sync after new doctors added
            if(doctorForm) doctorForm.addEventListener('submit', ()=> setTimeout(populateDoctorSelect,50));
            // initial populate
            populateDoctorSelect();

            // expose small API for console/testing
            window._dashboard = { showSection, openModal, closeModal, populateDoctorSelect };
        })();
    </script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
     <!-- 2. Firebase Config (MUST BE SECOND) -->
    <script src="firebase-config.js"></script>
    
    <!-- 3. Dashboard Script (MUST BE LAST) -->
    <script src="dashboard.js"></script>
</body>

</html>
<!-- Cache Buster: 2025-10-24-18:36 -->